<%#
/**
 * @template Chat
 * @description Real-time chat interface for plant discussions
 * 
 * Features:
 * - Socket.IO based real-time messaging
 * - Offline message caching
 * - Message persistence
 * - Online/offline status indicator
 * - Responsive chat layout
 * - Plant context display
 * 
 * Required Data:
 * @param {Object} data - Plant data object
 * @param {string} data._id - Plant ID
 * @param {string} data.plantName - Plant name
 * @param {string} username - Current user's username
 * 
 * Required Scripts:
 * - socket.io.min.js - Real-time communication
 * - chatScript.js - Chat functionality
 * - chatRenderScript.js - Message rendering
 * - chatIDBUtility.js - Offline storage
 */
%>

<!DOCTYPE html>
<html data-theme="cupcake">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="PlantPal">
    <title>PlantPal</title>
    <link rel="stylesheet" href="/css/outputStyles.css" />
    <link rel="manifest" href="/manifest.json"/>
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js" defer></script>
    <script src="/javascripts/utils/connectivityCheck.js" defer></script>
    <script src="/javascripts/user/userScript.js" defer></script>
    <script src="/javascripts/chat/chatScript.js" defer></script>
    <script src="/javascripts/chat/chatRenderScript.js" defer></script>
    <script src="/javascripts/chat/chatIDBUtility.js" defer></script>
    <script src="/javascripts/user/userRenderScript.js" defer></script>
    <script src="/tw-elements/dist/js/tw-elements.umd.min.js" defer></script>
</head>
<body>

<script>
    var plantId = '<%= data._id %>';
    var loggedInUser = '<%= username || data.nickname || "Guest" %>';
</script>

<div class="flex flex-col h-full">
    <!-- Chat Header -->
    <div class="bg-gray-100 p-4 rounded-t-lg border border-gray-300">
        <div class="flex justify-between items-center">
            <div class="text-xl font-medium">Chat on: <%= data.plantName %></div>
            <div class="flex items-center">
                <div class="flex items-center border-2 border-gray-700 border-opacity-100 rounded-full px-3 py-1">
                    <span id="chatStatusDot" class="w-2 h-2 bg-red-500 rounded-full mr-2"></span>
                    <span id="chatStatusText" class="text-base">Offline</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat Messages -->
    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chatMessages">
        <!-- Messages will be rendered here -->
    </div>

    <!-- Chat Input -->
    <div class="mt-auto border-t bg-white">
        <form id="chatForm">
            <%- include('./chatInputComponent.ejs') %>
        </form>
    </div>
</div>